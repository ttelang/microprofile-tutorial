= MicroProfile Tutorial - Developers Guide
:toc: macro
:toc-title: Table of Contents
:toclevels: 3
:doctype: book

This guide provides information for developers who want to download and work with the MicroProfile e-commerce application source code. Each chapter of the tutorial includes practical code examples that demonstrate various MicroProfile features.

toc::[]

## Overview

The MicroProfile Tutorial includes a comprehensive e-commerce application built with Jakarta EE 10 and MicroProfile 6.1. The application demonstrates real-world usage of MicroProfile features through a multi-service architecture including catalog, inventory, user, payment, and order services.

## Code Organization

The source code for the tutorial is organized by chapter in the `code/` directory. Each chapter builds upon the previous one, introducing new MicroProfile features and concepts:

```
code/
├── chapter02/    # Getting Started
├── chapter03/    # Persistence and Database
├── chapter04/    # Configuration
├── chapter05/    # Health Checks
├── chapter06/    # Metrics
├── chapter07/    # OpenAPI
├── chapter08/    # JWT Authentication
├── chapter09/    # Fault Tolerance
├── chapter10/    # REST Client
└── chapter11/    # Complete Application
```

### Chapter Structure

Each chapter directory contains one or more microservices with the following structure:

```
chapterXX/
├── <service-name>/
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/           # Java source code
│   │   │   ├── liberty/config/ # Open Liberty configuration
│   │   │   └── resources/      # Application resources
│   │   └── test/               # Unit and integration tests
│   ├── pom.xml                 # Maven build configuration
│   └── README.adoc             # Service-specific documentation
```

## Getting Started

### Prerequisites

Before working with the code, ensure you have the following installed:

#### Required Software

* **Java Development Kit (JDK) 17 or later**
* **Maven 3.8 or later** - For building the applications
* **Git** - For cloning the repository

#### Development Environment Setup

We recommend using SDKMAN for managing Java versions, as it makes it easy to switch between different JDK versions.

##### Installing SDKMAN

If SDKMAN is not already installed, follow the official instructions at https://sdkman.io/install/ or run:

[source,bash]
----
curl -s "https://get.sdkman.io" | bash
source "$HOME/.sdkman/bin/sdkman-init.sh"
----

##### Installing and Managing Java with SDKMAN

[source,bash]
----
# List available Java versions
sdk list java

# Install JDK 17 (Microsoft build)
sdk install java 17.0.15-ms

# List installed Java versions
sdk list java | grep -E ".*\s+installed"

# Switch to JDK 17 for the current shell session
sdk use java 17.0.15-ms

# Make JDK 17 the default for all sessions
sdk default java 17.0.15-ms

# Verify the current Java version
java -version
----

##### Recommended IDEs and Extensions

**Visual Studio Code:**
* Java Extension Pack
* Language Support for Java by Red Hat
* Liberty Tools for VS Code
* AsciiDoc extension (for viewing documentation)

**IntelliJ IDEA:**
* Built-in Java and Maven support
* MicroProfile plugin (available in the marketplace)
* Liberty plugin (available in the marketplace)

**Eclipse:**
* Eclipse IDE for Enterprise Java and Web Developers
* Liberty Developer Tools

## Downloading the Source Code

### Clone the Repository

To get all the code for the tutorial:

[source,bash]
----
git clone https://github.com/microprofile/microprofile-tutorial.git
cd microprofile-tutorial
----

### Navigate to a Specific Chapter

[source,bash]
----
# For example, to work with Chapter 3 code
cd code/chapter03/catalog
----

## Building and Running the Code

The tutorial applications use Maven and the Open Liberty Maven plugin for building and running.

### Building an Application

To build any microservice, navigate to its directory and run:

[source,bash]
----
mvn clean package
----

This command:
- Compiles the Java source code
- Runs unit tests
- Packages the application as a WAR file

### Running an Application

The easiest way to run an application is using the Liberty Maven plugin in development mode:

[source,bash]
----
mvn liberty:dev
----

**Development mode features:**
- Automatically rebuilds and redeploys on code changes
- Runs tests on demand by pressing Enter
- Supports hot reload for faster development
- Provides debugging capabilities

To exit development mode, press `Ctrl+C` or type `q` and press Enter.

### Accessing the Application

Once the server is running, you can access the application endpoints. The default configuration typically uses:

* **Host**: localhost (or your system hostname)
* **Port**: Varies by service (commonly 5050, 5051, 5052, etc.)

For example, for the catalog service in Chapter 3:
```
http://localhost:5050/catalog/api/products
```

Replace `localhost` with your system hostname if accessing from a different machine.

### Running Tests

To run the unit and integration tests:

[source,bash]
----
# Run all tests
mvn test

# Run a specific test class
mvn test -Dtest=YourTestClassName
----

## Working with Individual Chapters

Each chapter introduces specific MicroProfile features. Here's a brief overview:

### Chapter 2: Getting Started

**Location**: `code/chapter02/mp-ecomm-store/`

**Topics Covered**:
- Basic REST endpoints with Jakarta RESTful Web Services
- JSON processing with JSON-B
- Running on Open Liberty

**Key Endpoints**:
- `GET /mp-ecomm-store/api/products` - List products

### Chapter 3: Persistence and Database

**Location**: `code/chapter03/catalog/` and `code/chapter03/mp-ecomm-store/`

**Topics Covered**:
- Jakarta Persistence API (JPA)
- Derby embedded database
- Repository pattern
- Service layer with transactions
- Bean Validation

**Key Endpoints**:
- `GET /catalog/api/products` - List all products
- `GET /catalog/api/products/{id}` - Get product by ID
- `POST /catalog/api/products` - Create a new product
- `PUT /catalog/api/products/{id}` - Update a product
- `DELETE /catalog/api/products/{id}` - Delete a product

### Chapter 4: Configuration

**Location**: `code/chapter04/catalog/`

**Topics Covered**:
- MicroProfile Config
- Configuration sources (environment variables, system properties, microprofile-config.properties)
- Injecting configuration values
- Dynamic configuration updates

### Chapter 5: Health Checks

**Location**: `code/chapter05/catalog/` and `code/chapter05/payment/`

**Topics Covered**:
- MicroProfile Health
- Liveness checks
- Readiness checks
- Startup checks
- Custom health indicators

**Key Endpoints**:
- `GET /health` - Overall health status
- `GET /health/live` - Liveness probe
- `GET /health/ready` - Readiness probe

### Chapter 6: Metrics

**Location**: `code/chapter06/catalog/`

**Topics Covered**:
- MicroProfile Metrics
- Application metrics
- Custom counters, gauges, and timers
- Prometheus format export

**Key Endpoints**:
- `GET /metrics` - All metrics
- `GET /metrics/application` - Application-specific metrics

### Chapter 7: OpenAPI

**Location**: `code/chapter07/catalog/`

**Topics Covered**:
- MicroProfile OpenAPI
- API documentation annotations
- OpenAPI specification generation
- Swagger UI integration

**Key Endpoints**:
- `GET /openapi` - OpenAPI specification
- `GET /openapi/ui` - Swagger UI (if configured)

### Chapter 8: JWT Authentication

**Location**: `code/chapter08/payment/`

**Topics Covered**:
- MicroProfile JWT
- JWT token validation
- Role-based access control
- Securing REST endpoints

### Chapter 9: Fault Tolerance

**Location**: `code/chapter09/payment/`

**Topics Covered**:
- MicroProfile Fault Tolerance
- Timeout patterns
- Retry policies
- Circuit breakers
- Fallback methods
- Bulkhead patterns

### Chapter 10: REST Client

**Location**: `code/chapter10/order/` and `code/chapter10/user/`

**Topics Covered**:
- MicroProfile REST Client
- Type-safe REST client interfaces
- Client-side load balancing
- Integration between microservices

### Chapter 11: Complete Application

**Location**: `code/chapter11/`

**Topics Covered**:
- Complete microservices architecture
- All services integrated (catalog, inventory, user, payment, order)
- End-to-end application flow

**Services**:
- `catalog/` - Product catalog service
- `inventory/` - Inventory management service
- `user/` - User management service
- `payment/` - Payment processing service
- `order/` - Order management service

## Common Development Tasks

### Changing Server Ports

If you need to run multiple services simultaneously or avoid port conflicts, you can change the HTTP port in the Liberty server configuration.

Edit `src/main/liberty/config/server.xml`:

[source,xml]
----
<httpEndpoint id="defaultHttpEndpoint"
              host="*"
              httpPort="5050"  <!-- Change this port -->
              httpsPort="9443" />
----

### Configuring the Database

Most chapters use Derby embedded database for simplicity. The database configuration is in `src/main/resources/META-INF/persistence.xml`:

[source,xml]
----
<persistence-unit name="prod" transaction-type="JTA">
    <jta-data-source>jdbc/DefaultDataSource</jta-data-source>
    <properties>
        <!-- JPA and database properties -->
    </properties>
</persistence-unit>
----

### Adding Dependencies

To add new dependencies, edit the `pom.xml` file. The tutorial uses Maven for dependency management:

[source,xml]
----
<dependencies>
    <!-- Add your dependencies here -->
    <dependency>
        <groupId>org.example</groupId>
        <artifactId>example-library</artifactId>
        <version>1.0.0</version>
    </dependency>
</dependencies>
----

### Debugging the Application

When using `mvn liberty:dev`, you can attach a debugger on port 7777 (default debug port).

**In VS Code:**
1. Add a debug configuration to `.vscode/launch.json`
2. Set remote debugging to localhost:7777
3. Start the application with `mvn liberty:dev`
4. Attach the debugger

**In IntelliJ IDEA:**
1. Create a Remote JVM Debug configuration
2. Set host to localhost and port to 7777
3. Start the application with `mvn liberty:dev`
4. Run the debug configuration

## Technology Stack

The MicroProfile Tutorial applications use the following technology stack:

### Core Technologies

* **Jakarta EE 10** - Enterprise Java specifications
* **MicroProfile 6.1** - Cloud-native microservices specifications
* **Open Liberty** - Lightweight Jakarta EE and MicroProfile runtime
* **Maven** - Build and dependency management

### Jakarta EE APIs Used

* **Jakarta RESTful Web Services (JAX-RS)** - REST API development
* **Jakarta Persistence (JPA)** - Database persistence
* **Jakarta Contexts and Dependency Injection (CDI)** - Dependency injection
* **Jakarta Bean Validation** - Input validation
* **Jakarta JSON Binding (JSON-B)** - JSON serialization
* **Jakarta JSON Processing (JSON-P)** - JSON processing

### MicroProfile APIs Used

* **MicroProfile Config** - Configuration management
* **MicroProfile Health** - Health check endpoints
* **MicroProfile Metrics** - Application metrics
* **MicroProfile OpenAPI** - API documentation
* **MicroProfile JWT** - JWT authentication
* **MicroProfile Fault Tolerance** - Resilience patterns
* **MicroProfile REST Client** - Type-safe REST clients

### Additional Libraries

* **Lombok** - Reduces boilerplate code with annotations
* **JUnit 5** - Unit testing framework
* **Derby** - Embedded database (for development)

## Best Practices

When working with the tutorial code, consider these best practices:

### Development Workflow

1. **Start with Early Chapters**: If you're new to MicroProfile, start with Chapter 2 and progress sequentially.
2. **Read the Documentation**: Each service includes a README.adoc with specific instructions and explanations.
3. **Experiment**: The code is designed for learning - modify it, break it, and understand how it works.
4. **Use Development Mode**: Always use `mvn liberty:dev` during development for instant feedback.

### Code Organization

1. **Follow the Layered Architecture**: The code uses a clear separation between resources, services, repositories, and entities.
2. **Keep Services Small**: Each microservice focuses on a specific business capability.
3. **Use DTOs When Appropriate**: Don't expose entity classes directly in REST APIs for complex scenarios.

### Testing

1. **Write Tests**: Add unit tests for your changes to ensure they work correctly.
2. **Test in Development Mode**: Use the interactive testing feature in `mvn liberty:dev` by pressing Enter.
3. **Integration Tests**: Some chapters include integration tests that verify end-to-end functionality.

### Configuration

1. **Externalize Configuration**: Use MicroProfile Config for values that might change between environments.
2. **Use Profiles**: Configure different settings for development, testing, and production.
3. **Document Configuration**: Keep track of required configuration properties.

## Troubleshooting

### Common Issues and Solutions

#### Port Already in Use

**Problem**: Error message indicates the port is already in use.

**Solution**:
```bash
# Find process using the port (e.g., 5050)
lsof -i :5050

# Kill the process
kill <PID>

# Or change the port in server.xml
```

#### Maven Build Failures

**Problem**: Maven fails to download dependencies or build the project.

**Solution**:
```bash
# Clean Maven cache and rebuild
mvn clean install -U

# Verify Maven is properly configured
mvn -version

# Check your internet connection and proxy settings if behind a firewall
```

#### Liberty Server Doesn't Start

**Problem**: The Liberty server fails to start or crashes immediately.

**Solution**:
- Check the console output for error messages
- Verify JDK version is 17 or later
- Look at Liberty logs in `target/liberty/wlp/usr/servers/defaultServer/logs/`
- Ensure no other process is using the configured ports

#### Database Connection Errors

**Problem**: Application cannot connect to the database.

**Solution**:
- Verify the database configuration in `persistence.xml`
- Check that Derby is included in dependencies
- Look for database lock files that might need deletion
- Review Liberty server logs for detailed error messages

#### Changes Not Reflected

**Problem**: Code changes don't appear when accessing the application.

**Solution**:
- Ensure you're running in `mvn liberty:dev` mode
- Wait a few seconds for Liberty to detect and reload changes
- Check console output for compilation errors
- Try forcing a rebuild with Ctrl+R in dev mode

### Getting Help

If you encounter issues not covered here:

1. **Check the Service README**: Each service has its own README.adoc with specific information
2. **Review Liberty Logs**: Located in `target/liberty/wlp/usr/servers/defaultServer/logs/`
3. **Consult MicroProfile Documentation**: https://microprofile.io
4. **Open Liberty Guides**: https://openliberty.io/guides/
5. **Community Support**: 
   - MicroProfile Google Group: https://groups.google.com/forum/#!forum/microprofile
   - Stack Overflow: Tag questions with `microprofile`

## GitHub Codespaces Support

The tutorial code includes GitHub Codespaces configuration for cloud-based development:

### Using Codespaces

1. Navigate to the GitHub repository
2. Click "Code" → "Codespaces" → "Create codespace on main"
3. Wait for the environment to initialize
4. The codespace includes:
   - Pre-installed JDK 17 via SDKMAN
   - Maven build tools
   - VS Code extensions for Java development

### Codespace Configuration

The codespace configuration is defined in `.devcontainer/devcontainer.json` within each service directory. This ensures a consistent development environment across all developers.

## Next Steps

After setting up your development environment and exploring the code:

1. **Run the Examples**: Start with Chapter 2 and work through each chapter sequentially
2. **Modify the Code**: Try adding new features or changing existing functionality
3. **Build Your Own Service**: Create a new microservice using the patterns learned
4. **Integrate Services**: Practice calling one service from another using REST Client
5. **Deploy to Production**: Learn about deploying MicroProfile applications to cloud platforms

## Additional Resources

### Official Documentation

* **MicroProfile**: https://microprofile.io
* **Open Liberty**: https://openliberty.io
* **Jakarta EE**: https://jakarta.ee

### Learning Resources

* **Open Liberty Guides**: https://openliberty.io/guides/
* **MicroProfile Examples**: https://github.com/microprofile
* **Jakarta EE Tutorial**: https://eclipse-ee4j.github.io/jakartaee-tutorial/

### Community

* **MicroProfile Google Group**: https://groups.google.com/forum/#!forum/microprofile
* **Open Liberty Community**: https://openliberty.io/community/
* **Jakarta EE Community**: https://jakarta.ee/community/

## Contributing

If you find issues with the code or have suggestions for improvements:

1. Check existing issues in the GitHub repository
2. Create a new issue with:
   - Clear description of the problem or suggestion
   - Steps to reproduce (for bugs)
   - Expected vs. actual behavior
3. Consider submitting a pull request with fixes or enhancements

For documentation improvements, see the link:CONTRIBUTORS.adoc[Contributors Guide].
